<!DOCTYPE html>
<html>
<head>
    <title>Force Clear All Caches</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        button { padding: 10px 20px; margin: 10px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>Force Clear All Payment Caches</h1>
    <div id="status" class="status">Clearing all caches...</div>
    
    <script>
        function clearAllCaches() {
            try {
                let clearedCount = 0;
                const clearedKeys = [];
                
                // Clear all localStorage items related to payments
                const keysToRemove = [];
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && (
                        key.startsWith('paymentSummary_') ||
                        key.startsWith('feeStructure_') ||
                        key.startsWith('paymentCache_') ||
                        key.startsWith('studentCache_') ||
                        key.includes('payment') ||
                        key.includes('fee') ||
                        key.includes('medical')
                    )) {
                        keysToRemove.push(key);
                    }
                }
                
                keysToRemove.forEach(key => {
                    localStorage.removeItem(key);
                    clearedKeys.push(key);
                    clearedCount++;
                });
                
                // Clear sessionStorage as well
                const sessionKeysToRemove = [];
                for (let i = 0; i < sessionStorage.length; i++) {
                    const key = sessionStorage.key(i);
                    if (key && (
                        key.startsWith('paymentSummary_') ||
                        key.startsWith('feeStructure_') ||
                        key.includes('payment') ||
                        key.includes('fee')
                    )) {
                        sessionKeysToRemove.push(key);
                    }
                }
                
                sessionKeysToRemove.forEach(key => {
                    sessionStorage.removeItem(key);
                    clearedKeys.push('session:' + key);
                    clearedCount++;
                });
                
                // Clear window cache
                if (typeof window !== 'undefined') {
                    delete window.__feeStructCache;
                    delete window.__paymentCache;
                    delete window.__studentCache;
                    clearedCount += 3;
                }
                
                // Force reload the page to ensure fresh data
                document.getElementById('status').innerHTML = `
                    <div class="success">
                        <h2>✅ All Caches Cleared Successfully!</h2>
                        <p>Cleared ${clearedCount} cache entries:</p>
                        <ul>
                            ${clearedKeys.map(key => `<li>${key}</li>`).join('')}
                        </ul>
                        <p><strong>Please refresh the parent dashboard now to see the updated data.</strong></p>
                        <button onclick="window.close()">Close This Window</button>
                    </div>
                `;
                
                // Auto-close after 5 seconds
                setTimeout(() => {
                    window.close();
                }, 5000);
                
            } catch (error) {
                document.getElementById('status').innerHTML = `
                    <div class="error">
                        <h2>❌ Error clearing cache</h2>
                        <p>${error.message}</p>
                        <button onclick="clearAllCaches()">Try Again</button>
                    </div>
                `;
            }
        }
        
        // Run immediately
        clearAllCaches();
    </script>
</body>
</html>



