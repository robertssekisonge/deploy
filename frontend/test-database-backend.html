<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Database Backend Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        button {
            background: #4CAF50;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background: #45a049;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 5px;
            white-space: pre-wrap;
            font-family: monospace;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üóÑÔ∏è Database Backend Test</h1>
        <p>Testing PostgreSQL database backend with Prisma</p>
        
        <button onclick="testHealth()">üè• Test Health</button>
        <button onclick="testCreateSponsorship()">‚ûï Create Grace Sponsorship</button>
        <button onclick="testGetSponsorships()">üìã Get Sponsorships</button>
        <button onclick="testGetStudents()">üìö Get Students</button>
        <button onclick="testGetStats()">üìä Get Statistics</button>
        
        <div id="result"></div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:5000/api';
        
        function showResult(message, type = 'info') {
            const resultDiv = document.getElementById('result');
            resultDiv.className = `result ${type}`;
            resultDiv.textContent = message;
        }

        async function testHealth() {
            try {
                showResult('Testing database health endpoint...', 'info');
                const response = await fetch(`${API_BASE_URL}/health`);
                if (response.ok) {
                    const data = await response.json();
                    showResult(`‚úÖ Database health check successful!\n\nDatabase: ${data.database}\nPort: ${data.port}\n\nData Counts:\n- Sponsorships: ${data.data.sponsorships}\n- Students: ${data.data.students}\n- Users: ${data.data.users}\n\n${JSON.stringify(data, null, 2)}`, 'success');
                } else {
                    showResult(`‚ùå Health check failed: ${response.status} ${response.statusText}`, 'error');
                }
            } catch (error) {
                showResult(`‚ùå Health check error: ${error.message}`, 'error');
            }
        }

        async function testCreateSponsorship() {
            try {
                showResult('Creating Grace Nakato sponsorship in database...', 'info');
                
                const sponsorshipData = {
                    studentId: 'AA0001',
                    sponsorName: 'Test Sponsor',
                    sponsorCountry: 'Uganda',
                    amount: 500000,
                    type: 'EDUCATION',
                    sponsorshipStartDate: new Date().toISOString(),
                    message: 'I would like to sponsor Grace Nakato for her education. She dreams of becoming a doctor.'
                };

                const response = await fetch(`${API_BASE_URL}/sponsorships`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(sponsorshipData),
                });

                if (response.ok) {
                    const data = await response.json();
                    showResult(`‚úÖ Sponsorship created in database successfully!\n\nID: ${data.id}\nStatus: ${data.status}\nStudent ID: ${data.studentId}\nSponsor: ${data.sponsorName}\nAmount: ${data.amount}\n\n${JSON.stringify(data, null, 2)}`, 'success');
                } else {
                    const errorText = await response.text();
                    showResult(`‚ùå Failed to create sponsorship: ${response.status} ${response.statusText}\n\n${errorText}`, 'error');
                }
            } catch (error) {
                showResult(`‚ùå Error creating sponsorship: ${error.message}`, 'error');
            }
        }

        async function testGetSponsorships() {
            try {
                showResult('Getting all sponsorships from database...', 'info');
                const response = await fetch(`${API_BASE_URL}/sponsorships`);
                if (response.ok) {
                    const data = await response.json();
                    showResult(`‚úÖ Got ${data.length} sponsorships from database!\n\n${JSON.stringify(data, null, 2)}`, 'success');
                } else {
                    showResult(`‚ùå Failed to get sponsorships: ${response.status} ${response.statusText}`, 'error');
                }
            } catch (error) {
                showResult(`‚ùå Error getting sponsorships: ${error.message}`, 'error');
            }
        }

        async function testGetStudents() {
            try {
                showResult('Getting all students from database...', 'info');
                const response = await fetch(`${API_BASE_URL}/students`);
                if (response.ok) {
                    const data = await response.json();
                    showResult(`‚úÖ Got ${data.length} students from database!\n\n${JSON.stringify(data, null, 2)}`, 'success');
                } else {
                    showResult(`‚ùå Failed to get students: ${response.status} ${response.statusText}`, 'error');
                }
            } catch (error) {
                showResult(`‚ùå Error getting students: ${error.message}`, 'error');
            }
        }

        async function testGetStats() {
            try {
                showResult('Getting sponsorship statistics from database...', 'info');
                const response = await fetch(`${API_BASE_URL}/sponsorships/stats`);
                if (response.ok) {
                    const data = await response.json();
                    showResult(`‚úÖ Got sponsorship statistics!\n\nTotal: ${data.total}\nPending: ${data.pending}\nActive: ${data.active}\nCompleted: ${data.completed}\nTotal Amount: ${data.totalAmount}\n\n${JSON.stringify(data, null, 2)}`, 'success');
                } else {
                    showResult(`‚ùå Failed to get stats: ${response.status} ${response.statusText}`, 'error');
                }
            } catch (error) {
                showResult(`‚ùå Error getting stats: ${error.message}`, 'error');
            }
        }

        // Auto-test on page load
        window.onload = function() {
            showResult('üöÄ Database Backend Test Page Loaded\n\nThis page tests the PostgreSQL database backend with Prisma.\n\nClick "Test Health" to check if the database is connected and working.\n\nIf successful, you can then test creating and getting sponsorships from the database.', 'info');
        };
    </script>
</body>
</html>
